install.packages(c('tidyverse', 'skimr', 'corrplot', 'janitor', 'tidymodels'))
library(tidyverse)
library(skimr)
library(corrplot)
library(janitor)
library(tidymodels)
df <- read_csv('data/synthetic_customer_behavior_and_churn.csv')
head(df)
colnames(df)
n_distinct(df$customer_id)
glimpse(df)
skim(df)
df %>%
count(churn)
numeric_df <- df %>%
select(where(is.numeric))
cor_matrix <- cor(numeric_df)
corrplot(cor_matrix,
method = 'color',
type = 'upper',
tl.col = 'black',
tl.cex = 0.5)
df %>%
group_by(churn) %>%
summarise(across(where(is.numeric), mean))
df <- df %>%
mutate(
churn = factor(churn),
gender = factor(gender),
region = factor(region),
income_level = factor(income_level),
subscription_type = factor(subscription_type),
payment_method = factor(payment_method),
contract_type = factor(contract_type),
promotional_response = factor(promotional_response),
discount_used = factor(discount_used),
usage_frequency = factor(usage_frequency)
)
df <- df %>%
select(-customer_id, -total_charges, -signup_date)
set.seed(1998)
churn_split <- initial_split(df, prop = 0.8, strata = churn)
churn_train <- training(churn_split)
churn_test <- testing(churn_split)
count(churn_train, churn) %>%
mutate(prop = round(n/sum(n),2))
count(churn_test, churn) %>%
mutate(prop = round(n/sum(n),2))
model1 <- glm(churn ~ ., data = churn_train, family = binomial)
summary(model1)
pred <- predict(model1, newdata = churn_test, type = "response")
results <- churn_test |>
dplyr::mutate(
pred_class = factor(ifelse(pred > 0.5, 1, 0), levels = c(0, 1)),
churn      = factor(churn, levels = c(0, 1))
)
conf_mat(results, truth = churn, estimate = pred_class)
matrix[1]
matrix[1,1]
matrix[1,1]
print(matrix[1,1])
pred <- predict(model1, newdata = churn_test, type = "response")
results <- churn_test |>
dplyr::mutate(
pred_class = factor(ifelse(pred > 0.5, 1, 0), levels = c(0, 1)),
churn      = factor(churn, levels = c(0, 1))
)
cm <- conf_mat(results, truth = churn, estimate = pred_class)
cm
cm[1,1]
cm$overall
pred <- predict(model1, newdata = churn_test, type = "response")
results <- churn_test |>
dplyr::mutate(
pred_class = factor(ifelse(pred > 0.5, 1, 0), levels = c(0, 1)),
churn      = factor(churn, levels = c(0, 1))
)
cm <- conf_mat(results, truth = churn, estimate = pred_class)
cm
cm <- table(Predicted = pred_class, Actual = churn_test$churn)
cm <- table(Predicted = churn, Actual = churn_test$churn)
pred_class
results <- churn_test |>
mutate(
pred_class = factor(ifelse(pred > 0.5, 1, 0), levels = c(0, 1)),
churn      = factor(churn, levels = c(0, 1))
)
install.packages(c('tidyverse', 'skimr', 'corrplot', 'janitor', 'tidymodels',
'randomForest'))
library(randomForest)
model1 <- glm(churn ~ .,
data   = churn_train,
family = binomial(link = 'logit'))
pred <- predict(model1 , newdata = churn_test, type = 'response')
# Convert probs to binary
pred <- as.factor(ifelse(pred > 0.5, 1, 0))
# Evaluation Metrics
result    <- confusionMatrix(data = log.pred, test.df$churn)
install.packages(c('tidyverse', 'skimr', 'corrplot', 'janitor', 'tidymodels',
'randomForest', 'caret'))
library(caret)
model1 <- glm(churn ~ .,
data   = churn_train,
family = binomial(link = 'logit'))
pred <- predict(model1 , newdata = churn_test, type = 'response')
# Convert probs to binary
pred <- as.factor(ifelse(pred > 0.5, 1, 0))
# Evaluation Metrics
result    <- confusionMatrix(data = log.pred, test.df$churn)
# Evaluation Metrics
result    <- confusionMatrix(data = pred, churn_test$churn)
model1 <- glm(churn ~ .,
data   = churn_train,
family = binomial(link = 'logit'))
pred <- predict(model1 , newdata = churn_test, type = 'response')
# Convert probs to binary
pred <- as.factor(ifelse(pred > 0.5, 1, 0))
# Evaluation Metrics
result    <- confusionMatrix(data = pred, churn_test$churn)
precision <- result$byClass['Pos Pred Value']
recall    <- result$byClass['Sensitivity']
F1        <- result$byClass['F1']
precision
recall
F1
result
tree_model <- rpart(churn ~ .,
data = churn_train,
method = "class",
control = rpart.control(xval = 10))
install.packages(c('tidyverse', 'skimr', 'corrplot', 'janitor', 'tidymodels',
'randomForest', 'caret', 'rpart', 'rpart.plot'))
tree_model <- rpart(churn ~ .,
data = churn_train,
method = "class",
control = rpart.control(xval = 10))
library(tidyverse)
library(skimr)
library(corrplot)
library(janitor)
library(tidymodels)
library(randomForest)
library(caret)
library(rpart)
tree_model <- rpart(churn ~ .,
data = churn_train,
method = "class",
control = rpart.control(xval = 10))
# Plot
plot(tree_model)
# Plot
rpart.plot(tree_model)
install.packages("rpart.plot")
tree_model <- rpart(churn ~ .,
data = churn_train,
method = "class",
control = rpart.control(xval = 10))
# Plot
rpart.plot(tree_model)
library(tidyverse)
library(skimr)
library(corrplot)
library(janitor)
library(tidymodels)
library(randomForest)
library(caret)
library(rpart)
library(rpart.plot)
tree_model <- rpart(churn ~ .,
data = churn_train,
method = "class",
control = rpart.control(xval = 10))
# Plot
rpart.plot(tree_model)
pred      <- predict(tree_model, newdata = churn_test, type = "class")
result    <- confusionMatrix(data = pred, churn_test$churn)
precision <- result$byClass['Pos Pred Value']
recall    <- result$byClass['Sensitivity']
F1        <- result$byClass['F1']
result
pred      <- predict(tree_model, newdata = churn_test, type = "class")
result    <- confusionMatrix(data = pred, churn_test$churn, positive = '1')
precision <- result$byClass['Pos Pred Value']
recall    <- result$byClass['Sensitivity']
F1        <- result$byClass['F1']
result
pred      <- predict(tree_model, newdata = churn_test, type = "class")
result    <- confusionMatrix(data = pred, churn_test$churn)
precision <- result$byClass['Pos Pred Value']
recall    <- result$byClass['Sensitivity']
F1        <- result$byClass['F1']
install.packages(c('tidyverse', 'skimr', 'corrplot', 'janitor', 'tidymodels',
'randomForest', 'caret', 'rpart', 'rpart.plot'))
library(tidyverse)
library(skimr)
library(corrplot)
library(janitor)
library(tidymodels)
library(randomForest)
library(caret)
library(rpart)
library(rpart.plot)
df <- read_csv('data/synthetic_customer_behavior_and_churn.csv')
head(df)
colnames(df)
n_distinct(df$customer_id)
glimpse(df)
skim(df)
df %>%
count(churn)
numeric_df <- df %>%
select(where(is.numeric))
cor_matrix <- cor(numeric_df)
corrplot(cor_matrix,
method = 'color',
type = 'upper',
tl.col = 'black',
tl.cex = 0.5)
df %>%
group_by(churn) %>%
summarise(across(where(is.numeric), mean))
df <- df %>%
mutate(
churn = factor(churn),
gender = factor(gender),
region = factor(region),
income_level = factor(income_level),
subscription_type = factor(subscription_type),
payment_method = factor(payment_method),
contract_type = factor(contract_type),
promotional_response = factor(promotional_response),
discount_used = factor(discount_used),
usage_frequency = factor(usage_frequency)
)
df <- df %>%
select(-customer_id, -total_charges, -signup_date)
set.seed(1998)
churn_split <- initial_split(df, prop = 0.8, strata = churn)
churn_train <- training(churn_split)
churn_test <- testing(churn_split)
count(churn_train, churn) %>%
mutate(prop = round(n/sum(n),2))
count(churn_test, churn) %>%
mutate(prop = round(n/sum(n),2))
model1 <- glm(churn ~ .,
data   = churn_train,
family = binomial(link = 'logit'))
pred <- predict(model1 , newdata = churn_test, type = 'response')
# Convert probs to binary
pred <- as.factor(ifelse(pred > 0.5, 1, 0))
# Evaluation Metrics
result    <- confusionMatrix(data = pred, churn_test$churn)
precision <- result$byClass['Pos Pred Value']
recall    <- result$byClass['Sensitivity']
F1        <- result$byClass['F1']
result
tree_model <- rpart(churn ~ .,
data = churn_train,
method = "class",
control = rpart.control(xval = 10))
# Plot
rpart.plot(tree_model)
pred      <- predict(tree_model, newdata = churn_test, type = "class")
result    <- confusionMatrix(data = pred, churn_test$churn)
precision <- result$byClass['Pos Pred Value']
recall    <- result$byClass['Sensitivity']
F1        <- result$byClass['F1']
result
pred      <- predict(tree_model, newdata = churn_test, type = "class")
result    <- confusionMatrix(data = pred, churn_test$churn, positive = '1')
precision <- result$byClass['Pos Pred Value']
recall    <- result$byClass['Sensitivity']
F1        <- result$byClass['F1']
result
model1 <- glm(churn ~ .,
data   = churn_train,
family = binomial(link = 'logit'))
pred <- predict(model1 , newdata = churn_test, type = 'response')
# Convert probs to binary
pred <- as.factor(ifelse(pred > 0.5, 1, 0))
# Evaluation Metrics
result    <- confusionMatrix(data = pred, churn_test$churn, positive = '1')
precision <- result$byClass['Pos Pred Value']
recall    <- result$byClass['Sensitivity']
F1        <- result$byClass['F1']
result
